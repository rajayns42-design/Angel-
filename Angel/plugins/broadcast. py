import asyncio
from pyrogram import Client, filters
from pyrogram.errors import FloodWait, UserIsBlocked, InputUserDeactivated

# --- OWNER ID (ZEXX ONLY) ---
OWNER_ID = 123456789  # <--- Apni ID yahan daalna
line = "‚ú® ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ‚ú®"

@Client.on_message(filters.command("broadcast") & filters.user(OWNER_ID))
async def global_broadcast(client, message):
    if not message.reply_to_message:
        return await message.reply_text("<b>‚ùå Error:</b> Kisi message par reply karke `/broadcast` likho!")

    ex_msg = await message.reply_text("<b>üöÄ …¢ ü·¥è ô·¥Ä ü  ô Ä·¥è·¥Ä·¥Ö·¥Ñ·¥Äs·¥õ s·¥õ·¥Ä Ä·¥õ·¥á·¥Ö...</b>\n<i>Users + Groups ko bhej rahi hoon!</i>")
    
    done = 0
    failed = 0
    blocked = 0

    # Saare dialogs (Groups + Users) fetch karna
    async for dialog in client.get_dialogs():
        chat_id = dialog.chat.id
        try:
            # Fast Copy Method
            await message.reply_to_message.copy(chat_id)
            done += 1
            await asyncio.sleep(0.1) # Sabse fast speed limit

        except FloodWait as e:
            await asyncio.sleep(e.value)
            await message.reply_to_message.copy(chat_id)
            done += 1
        except (UserIsBlocked, InputUserDeactivated):
            blocked += 1
            failed += 1
        except Exception:
            failed += 1
            continue

    await ex_msg.edit(
        f"<b>‚úÖ  ô Ä·¥è·¥Ä·¥Ö·¥Ñ·¥Äs·¥õ ·¥Ñ·¥è·¥ç·¥ò ü·¥á·¥õ·¥á·¥Ö!</b>\n"
        f"{line}\n"
        f"üë§ <b>·¥è·¥°…¥·¥á Ä:</b> ·¥¢·¥áxx\n"
        f"üì§ <b>s·¥ú·¥Ñ·¥Ñ·¥áss:</b> {done}\n"
        f"üö´ <b> ô ü·¥è·¥Ñ·¥ã·¥á·¥Ö/ ü·¥á“ì·¥õ:</b> {blocked}\n"
        f"‚ùå <b>“ì·¥Ä…™ ü·¥á·¥Ö:</b> {failed - blocked}\n"
        f"{line}\n"
        f"<i>Sab jagah dhamaka ho gaya! üî•</i>"
    )
